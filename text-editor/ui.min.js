/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.3.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function Me(e){return e.toLowerCase()}function _e(e){return M(e)?m(e).split(/\s+/):e}function Oe(e){return $(e)?e.join(" "):e}function He(e,t){return-1!==e.indexOf(t)}function Ne(e){return Object.keys(e)}function Be(e){return e.length}function De(e){return Be(Ne(e))}function je(e,t,n){return L(e)?L(t)?(L(g[e])||(g[e]={}),L(n)||(n=De(g[e])),g[e][n]=t,l):g[e]:g}function Ae(e,t){return L(e)?L(t)&&L(g[e])?(delete g[e][t],l):(g[e]={},l):(g={},l)}function Se(e,t,n){if(!L(g[e]))return g[e]={},l;if(L(n))L(g[e][n])&&g[e][n].apply(l,t);else for(W in g[e])g[e][W].apply(l,t);return l}function Ye(e,t,n){if($(t))for(W in t)Ye(e,W,t[W]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Fe(e,n,i){if(!n){for(t={},W=0,X=e.attributes,q=Be(X);q>W;++W)K=X[W],t[K.name]=K.value;return De(t)?t:L(i)?i:{}}if(M(n))return Fe(e,[n],[L(i)?i:""])[0];t=[];for(W in n)W=n[W],W=e.getAttribute(W)||"",t.push(W);return Be(t)?t:L(i)?i:[]}function Ie(e,t){if($(t))for(W in t)Ie(e,t[W]);else if(L(t))e.removeAttribute(t);else for(Ie(e,"class"),W=0,X=e.attributes,q=Be(X);q>W;++W)X[W]&&Ie(e,X[W].name)}function Re(e,t,n){if($(t))for(W in t)Re(e,W,t[W]);else Ye(e,"data-"+t,n)}function We(e,n,i){if(!n){for(t={},W=0,X=e.attributes,q=Be(X);q>W;++W)K=X[W],"data-"===K.name.slice(0,5)&&(t[K.name]=K.value);return De(t)?t:L(i)?i:{}}if(M(n))return We(e,[n],[L(i)?i:""])[0];t=[];for(W in n)W=n[W],W=Fe(e,"data-"+W),t.push(W);return Be(t)?t:L(i)?i:[]}function Xe(e,t){if($(t))for(W in t)Ie(e,"data-"+t[W]);else if(L(t))Ie(e,"data-"+t);else for(W=0,X=e.attributes,q=Be(X);q>W;++W)X[W]&&"data-"===X[W].name.slice(0,5)&&Ie(e,X[W].name)}function qe(e){return e&&e.preventDefault(),!1}function Ke(e,t,n){if(t){for(e=_e(e),W=0,X=Be(e);X>W;++W)t.addEventListener(e[W],n,!1),je("on:"+e[W],n,st(t));return l}}function Ue(e,t,n){if(t){for(e=_e(e),W=0,X=Be(e);X>W;++W)t.removeEventListener(e[W],n,!1),Ae("on:"+e[W],st(t));return w(t)&&t.id.split(":")[0]===Nt+"-dom"&&Ie(t,"id"),l}}function Ze(e,t,n){e=_e(e);var r,i="createEvent"in u;for(W=0,X=Be(e);X>W;++W)i?(r=u.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[W],!0,!1),t.dispatchEvent(r)):Se("on:"+e[W],n,st(t));return l}function Ge(e,t,n){for(W=0,X=Be(t),q;X>W;++W)q=t[W],e=e.replace(C(q)?q:h(p(q),"g"),n&&n[W]||"");return e}function Je(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,L(t[n])?t[n]:e})}function Pe(e){return m(Ge(Me(e),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Qe(e,t){var n="touches",i="clientX",r="clientY",o=t[n]?t[n][0][i]:t[i],f=t[n]?t[n][0][r]:t[r],s=Ve(e);return{x:o-s.l,y:f-s.t}}function Ve(e){return P=e.getBoundingClientRect(),{l:P.x,t:P.y}}function et(e){return e===s?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function tt(e,t){for(;(e=dt(e))&&e!==t;);return e}function nt(e,t){t=_e(t);for(W in t)e.classList.add(t[W])}function it(e,n,i){if(!n)return t=_e(e.className),Be(t)?t:L(i)?i:[];if(M(n))return it(e,[n],[L(i)?i:""])[0];t=[];for(W in n)W=n[W],e.classList.contains(W)&&t.push(W);return Be(t)?t:L(i)?i:[]}function rt(e,t){if(L(t)){t=_e(t);for(W in t)e.classList.remove(t[W])}else Ie(e,"class")}function ot(e,t){t=_e(t);for(W in t)e.classList.toggle(t[W])}function ft(e,t,n){if(e=e||"div",e=M(e)?u.createElement(e):e,$(n)){t||(L(n.html)?(t=n.html,delete n.html):L(n.text)&&(t=n.text,delete n.text));for(W in n)if(te=n[W],"classes"===W)nt(e,te);else if("data"===W)for(X in te)te=te[X],null===te?Xe(e,X):Re(e,X,te);else"css"===W?M(te)?Ye(e,"style",te):null===te?Ie(e,"style"):c(e,te):T(te)?e[W]=te:null===te?Ie(e,W):Ye(e,W,E(te)?te.join(" "):""+te)}if(w(t))zt(e,t);else if($(t))for(W in t)te=t[W],w(te)?zt(e,te):te!==!1&&ut(e,te);else L(t)&&t!==!1&&ut(e,t);return e}function st(e){var t=e.id;return t||(t=Nt+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function ut(e,t){e.innerHTML=t}function lt(e,t){return e.innerHTML||(L(t)?t:"")}function at(e,t){if((!L(t)||t)&&(A=pt(e)))for(W=0,X=Be(A);X>W;++W)at(A[W]);ut(e,"")}function ct(e){return Array.prototype.slice.call(e)}function dt(e){return e&&e.parentNode}function pt(e){return e&&ct(e.children||[])}function bt(e,t){return L(t)?M(t)?e.closest(t):tt(e,t):dt(e)}function ht(e){return e&&e.nextElementSibling}function yt(e){return e&&e.previousElementSibling}function xt(e){for(W=0;e=yt(e);)++W;return W}function mt(e,t){return e&&M(t)?Me(e.nodeName)===Me(t):e&&T(t)?e===t(e):e===t}function gt(e,t){return(t=L(t)?t:u)?M(e)?/^[#.]?(?:\\.|[\w-]|[^\x00-\xa0])+$/.test(e)?"#"===e[0]&&(e=t.getElementById(e.slice(1)))?[e]:"."===e[0]&&(e=t.getElementsByClassName(e.slice(1)))||(e=t.getElementsByTagName(e))?ct(e):[]:ct(t.querySelectorAll(e)):vt(e)?[e]:[]:[]}function vt(e,t){var n=dt(e);return 1===Be(arguments)?n||!1:e&&n===e?n:!1}function kt(e,t){G=dt(e),G&&G.insertBefore(t,e)}function wt(e,t){G=dt(e),G&&G.insertBefore(t,ht(e))}function Et(e,t){A=e.firstChild,A?kt(A,t):zt(e,t)}function Tt(e,t){zt(e,t)}function zt(e,t){e.appendChild(t)}function $t(e,t){var n=dt(e);if(n){if(!L(t)||t)for(A=e.firstChild;A;)$t(A);n.removeChild(e)}}function Ct(e,t){return e.cloneNode(L(t)?!!t:!0)}function Lt(e,t){return dt(e).replaceChild(t,e),t}function Mt(e){at(ft(e,!1,{style:""})),$t(e)}function _t(e,t,n){return ft(t,n,{"class":e})}function on(e){return!e||L(e.active)&&!e.active}function fn(e,t,n){return T(e)&&(e={click:e}),M(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Bt[t]||"",L(e.attributes)||(e.attributes={}),n[t]&&(n[t]=e),e}function sn(e){Ot.exit(0,0,0);var t=We(this,"tool-id"),n=Ot.tools,i=n[t];return Ot.drop.target=e.currentTarget||e.target,!on(i)&&T(X=i.click)&&(X=X(e,l,t),Se("on:change",[e,l,t]),X===!1)?qe(e):(l.select(),qe(e))}function un(e){if(V=this,(q=e.TE.key)(["escape","f10"]))Ot.exit(1);else if(q("enter")||q("down")&&We(V,"ui-drop"))Ot.drop.target=V,Ze(se,V,[e]);else if(q("right")&&(K=ht(V))){for(;!mt(K,"a")&&K;)K=ht(K);K&&K.focus()}else if(q("left")&&(K=yt(V))){for(;!mt(K,"a")&&K;)K=yt(K);K&&K.focus()}return qe(e)}function an(){at(Xt,0);var r,o,f,s,u,a,c,e=Ot.tools,t=_e(N.tools),n=Nt+"-button",i=Nt+"-separator";N.tools=t;for(a in t)c=t[a],o=e[c],(o||o==={})&&(o=fn(o,c,e),f=o.i||c,"|"===f||He(f,"<")||(f=Pe(f)),s="|"!==f,u=Pe(c).replace(/[\/\s]/g,"-"),nn=_t(s?n+" "+n+"-"+u:i+" "+i+"-"+a,s?"a":"span"),s?(nn=o.target||nn,r=n+":"+u,Ye(nn,{href:Ce,id:r,tabindex:-1}),Re(nn,"tool-id",c),f=He(f,"<")?f:Ot.i(u,f),on(o)?nt(nn,"x"):rt(nn,"x"),o.on?nt(nn,"on"):rt(nn,"on"),o.text&&(f=Je('<span class="'+Nt+'-text">'+o.text+"</span>",[f]),nt(nn,"text")),ut(nn,f),ft(nn,!1,o.attributes),!o.attributes.title&&(X=o.title)&&(nn.title=$(X)?X[0]+(X[1]?" ("+X[1]+")":""):X),Ke(se,nn,sn),Ke(de,nn,un)):nn.id=i+":"+a,o.target=nn,(u=We(nn,ln))&&Ot.menu.set(c,u),zt(Xt,nn));Se("update.tools",[l])}function cn(){Ot.keys=function(){var n,e=Ne(Ot.keys).sort().reverse(),t={};for(W=0,X=Be(e);X>W;++W)n=e[W],t[n]=Ot.keys[n];return t}(),pn(),Se("update.keys",[l])}function dn(e){function b(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=l.$(),i=n.before,r=n.after,o=i.slice(-1),f=r[0],s=n.length,u=Ot.keys,a=TE.keys_a,c={control:0,shift:0,option:"alt",meta:0},d=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();for(W in c)e.TE[W]()&&(B[c[W]||W]=1);Z=e.TE.key(),B[Z]=1,t=De(B),x(function(){l.record()});for(W in u){q=b(W),A=0;for(X in q)X=q[X],B[a[X]||X]&&++A;if(q=Be(q),A===q&&t===q&&(M(u[W])&&(u[W]=Ot.tools[u[W]].click),K=T(u[W])?u[W](e,l):0,K===!1))return qe(e)}if(ge)for(W in ge)if(U=ge[W],U!==!1){if(Z===U&&f===U)return"\\"===o?(l.insert(Z,0),qe(e)):(l.select(n.end+1),qe(e));if(W===Z)return l.wrap(W,U),qe(e);if(o===W&&f===U){if("backspace"===Z&&i.slice(-2)!=="\\"+W)return l.unwrap(W,U),qe(e);if(ve&&"enter"===Z&&W!==U&&!s)return l.tidy("\n"+d+we,"\n"+d).scroll(1),qe(e)}}if(ve&&!s){if("backspace"===Z&&h(p(we)+"$").test(i))return l.outdent(we),qe(e);if("enter"===Z&&h("(^|\\n)("+p(we)+")+.*$").test(i))return l.insert("\n"+d,0,1).scroll(1),qe(e)}}function pn(e){e&&e.TE&&e.TE.key?delete B[e.TE.key()]:B={}}function mn(e){return bn=St,Q=et(Wt),qe(e)}function gn(e){bn===St&&c(qt,{height:Qe(Rt,e).y-Q.h+Le})}function vn(){bn=0}function kn(){Ot.exit(1)}function wn(){t=et(Gt),ne=t.w,R=t.h,t=et(Zt),hn=t.w,yn=t.h}function En(e,t){return t&&Se("exit.modal."+t,[l]),Ze(se,Zt,[e]),qe(e)}function Tn(e){bn=e.target,t=Qe(Gt,e),ie=t.x,re=t.y,wn()}function zn(e){var n=xn.header,i=xn.sizer;bn===n||tt(bn,n)===n?(t=Qe(Rt,e),K=t.x-ie,V=t.y-re,c(Gt,{left:(ne>hn?K:d(K,0,hn-ne))+Le,top:(R>yn?V:d(V,0,yn-R))+Le})):bn===i&&(t=Qe(Gt,e),Q=et(i),c(Gt,{width:t.x+Q.w/4+Le,height:t.y+Q.h/4+Le}))}function $n(){bn=0}function Cn(e,t,n){return{header:e,body:t,footer:n}}function Ln(e){D=Ot.drop.target,j=Jt,A=e&&e.target||0,(!A||A!==D&&tt(A,D)!==D)&&(Ot.drop.target=0,Ot.exit(A===qt))}var D,j,A,F,R,W,X,q,K,U,Z,t,G,P,Q,V,ee,te,ne,ie,re,n="⌘",i="…",r="⌥",o="⇥",f="⇧",s=window,u=document,l=new TE(e),a=l._,c=a.css,d=a.edge,p=a.x,b=a.extend,h=a.pattern,y=a.timer.reset,x=a.timer.set,m=a.trim,g={},v=function(){},k=TE.is,w=k.e,E=k.a,T=k.f,z=k.i,$=k.o,C=k.r,L=function(e){return!k.x(e)},M=k.s,_=u.documentElement,H=(u.head,u.body),N=b({tab:"  ",direction:"ltr",path:TE.path,resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},union:[[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]],[["<",">","/"],["=",'"','"'," "]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools",r+"+F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%2"}},t),B={},fe="blur",se="click",de="keydown",pe="keyup",be="touchstart mousedown",he="touchmove mousemove",ye="touchend mouseup",me="orientationchange resize",ge=N.auto_close,ve=N.auto_tab,ke=N.languages,we=N.tab,Te=(N.union[1][1],N.union[1][0]),ze=N.union[0][1],$e=N.union[0][0],Ce="javascript:;",Le="px",Ot=l.ui={};l.tidy=function(e,t){var n=l.$(),i=m(n.before)?e:"",r=m(n.after)?L(t)?t:e:"";return l.trim(i,r)},l.i=function(){return m(l.replace(/\s+/g," "))},l.format=function(e,t,n,i){$(e)||(e=[e]),L(n)||(n=" "),L(i)||(i="");var r=l.h,o=l[0]().$(),f=e[0].split(h("("+ze[3]+")+"))[0],s=(e[0]?Te[0]+e[0]+Te[1]:"")+i,u=i+(e[0]?Te[0]+Te[2]+(e[1]||f)+Te[1]:""),a=p(e[0]?Te[0]+f+Te[1]:""),c=p(u),d=h("^"+a+"([\\s\\S]*?)"+c+"$"),b=h(a+"$"),y=h("^"+c),x=o.before,m=o.after;return o.length?n=!1:l.insert(ke.placeholders[""]),l.toggle(t?!d.test(o.value):!b.test(x)&&!y.test(m),[function(e){e.unwrap(s,u,1).tidy(h($e[0]+"[^"+$e[0]+$e[1]+$e[2]+"]+?"+$e[1]+"$").test(x)?"":n,h("^"+$e[0]+$e[2]+"[^"+$e[0]+$e[1]+"]+?"+$e[1]).test(m)?"":n).wrap(s,u,t)},function(e){e.unwrap(s,u,t)}])[r]()};var nn,Ht=N.classes,Nt=Ht[""],Bt=ke.tools,Dt=ke.buttons,jt=ke.labels,At=Nt+"-textarea "+Nt+"-content block",St=_t(Nt+"-sizer s"),Yt=_t(Nt+"-sizer se"),Ft=_t(Nt),It=_t(Nt+"-header"),Rt=_t(Nt+"-body"),Wt=_t(Nt+"-footer"),Xt=_t(Nt+"-tool"),qt=ft(e,!1,N.attributes),Kt=_t(Nt+"-description"),Ut=ft(),Zt=ft(),Gt=ft(),Jt=ft(),Pt=ft(),Qt=ft(),Vt=_t("left","span"),en=_t("right","span"),tn=0;Ot.i=function(e,t,n){return e=Pe(e).replace(/[\/\s]/g,"-"),Q=Je(Ht.i,[e,t||e]),n?(rt(n),nt(n,Q),n):'<i class="'+Q+'"></i>'},L(N.suffix)||(N.suffix=Te[1]);var ln="ui-drop-data",bn=0,ie=0,re=0,ne=0,R=0,hn=0,yn=0,xn={};l.create=function(e,t){if(l.is.create)return l;l.is.create=!0,$(e)&&(N=b(N,e));var n=vt(qt);return nt(Ft,Nt+"-is-can-update"),nt(Ft,Nt+"-is-can-copy"),nt(qt,At),n&&mt(n,"p")?(kt(n,Ft),tn=n,$t(n,!1)):kt(qt,Ft),Ft.dir=N.direction,zt(Ft,It),zt(Ft,Rt),zt(Ft,Wt),zt(Rt,qt),N.tools&&(zt(It,Xt),zt(Wt,Kt),zt(Kt,Vt),zt(Kt,en)),Ke(de,qt,dn),Ke(pe+" "+fe,qt,pn),Z=Nt+"-is-can-resize",N.resize?(zt(Ft,St),nt(Ft,Z),Ke(be,St,mn),Ke(he,u,gn),Ke(ye,u,vn)):rt(Ft,Z),an(),cn(),0!==t?Se("create",[l]):l},l.update=function(e,t){return l.is.create&&l.destroy(0),(0!==t?Se("update",[l]):l).create(e,0)},l.destroy=function(e){return l.is.create?(l.is.create=!1,Ot.exit(0,0,0),rt(qt,At),N.tools=Oe(N.tools),N.keys&&(Ue(de,qt,dn),Ue(pe,qt,pn)),N.resize&&(Ue(be,St,mn),Ue(he,u,gn),Ue(ye,u,vn)),tn?(kt(Ft,tn),zt(tn,qt),tn=0):kt(Ft,qt),Mt(Ft),0!==e?Se("destroy",[l]):l):l},l.enable=function(e){return qt.disabled=qt.readOnly=!1,nt(Ft,Nt+"-is-can-update"),nt(Ft,Nt+"-is-can-copy"),0!==e?Se("enable",[l]):l},l.disable=function(e){return qt.disabled=!0,rt(Ft,Nt+"-is-can-update"),rt(Ft,Nt+"-is-can-copy"),0!==e?Se("disable",[l]):l},l.freeze=function(e){return qt.disabled=!1,qt.readOnly=!0,rt(Ft,Nt+"-is-can-update"),nt(Ft,Nt+"-is-can-copy"),0!==e?Se("freeze",[l]):l},Ot.exit=function(e,t,n){if(F={panel:function(){Mt(Ut)},overlay:function(){Ue(se,Zt,kn),Mt(Zt)},modal:function(){Ue(se+" "+de,xn.x,En),Ue(be,Rt,Tn),Ue(he,Rt,zn),Ue(ye,u,$n),Mt(Gt)},drop:function(){Ue(se,u,Ln),Ue(me,s,Ln),Mt(Jt)},bubble:function(){Mt(Pt)}},pn(),t)if($(t))for(W in t)W=t[W],F[W]&&F[W](),0!==n&&Se("exit."+W,[l]);else F[t]&&F[t](),0!==n&&Se("exit."+W,[l]);else for(W in F)F[W]();return e&&l.select(),0!==n&&Se("exit",[l]),l},Ot.panel=function(e,t,n,i){function r(e){return Ue(se+" "+de,ie,r),Ot.panel.exit(1),qe(e)}return Ot.exit(0,0,0),K=Pe(e),V=0,i&&(K+=" "+K+"--"+Pe(i)),$(t)&&!w(t)&&(V=_t(Nt+"-panel-header "+K,0,t.header),t=t.body),ee=_t(Nt+"-panel-body "+K,0,_t(Nt+"-panel-content "+K,0,T(t)?"":t)),T(t)&&t(ee),ie=ft("a",!1,{href:Ce,"class":Nt+"-a "+Nt+"-x "+K}),ie.title=Dt.close,ft(Ut,!1,{"class":Nt+"-panel "+K}),Ke(se+" "+de,ie,r),at(Ut,0),V&&zt(Ut,V),zt(Rt,ft(Ut,[ee,ie])),T(n)?n(Ut):M(n)&&ft(Ut,n),D=[l,Ut],i&&Se("enter.panel."+e+":"+i,D),Se("enter.panel."+e,D),Se("enter.panel",D),Se("enter",D),ie.focus(),l},Ot.panel.fit=function(){},Ot.overlay=function(e,t,n,i){return Ot.exit(0,0,0),K=Pe(e),i&&(K+=" "+K+"--"+Pe(i)),zt(Rt,ft(Zt,!1,{"class":Nt+"-overlay "+K})),t&&Ke(se,Zt,kn),T(n)?n(Zt):M(n)&&ft(Zt,n),D=[l,Zt],i&&Se("enter.overlay."+e+":"+i,D),Se("enter.overlay."+e,D),Se("enter.overlay",D),Se("enter",D),l},Ot.overlay.fit=function(){},Ot.message=function(e,t,n,i,r){function f(e){return Ue(se+" "+de,ie,f),y(o),Ot.overlay.exit(1),qe(e)}var o;return K=Pe(e),r&&(K+=" "+K+"--"+Pe(r)),ie=ft("a",!1,{href:Ce,"class":Nt+"-a "+Nt+"-x "+K}),ie.title=Dt.close,ft(Qt,T(t)?t(Qt):t,{"class":Nt+"-message "+K}),Ke(se+" "+de,ie,f),Ot.overlay("message message-"+K,0,function(e){zt(Qt,ie),n&&(o=x(function(){f()},n)),zt(e,Qt)},r),T(i)?i(Qt):M(i)&&ft(Qt,i),l},Ot.modal=function(){var s,a,e=arguments,t=e[0],n=e[1],i=e[2],r=e[3],o=Nt+"-modal",f=n.footer;if($(t)&&(t="default",n=e[0],i=e[1],r=e[2]),Ot.overlay(t,1,0,r).blur(),K=Pe(t),r&&(K+=" "+K+"--"+Pe(r)),ft(Gt,!1,{"class":o+" "+K}),L(n.body)&&(n.body=ft("div",n.body,{"class":o+"-content "+K})),L(f)&&$(f)&&!w(f)){a=[];for(W in f)X=f[W],w(X)?a.push(X):(X=fn(X,W,f),q=W.text||Dt[W]||W,s=ft("button",q,b({name:"y["+W+"]",type:"button","class":Nt+"-button",data:{"button-id":W}},X.attributes)),Ke(se,s,function(e){return q=f[We(this,"button-id")].click(e,l),q===!1?qe(e):void 0}),a.push(s));n.footer=a}for(W in n)o[1]=W,xn[W]=_t(o+"-"+Je(W,o)+" "+K,0,n[W]);return xn.x=ft("a",!1,{href:Ce,"class":Nt+"-a "+Nt+"-x "+K}),xn.sizer=Yt,at(Gt,0),xn.x.title=Dt.close,zt(Rt,ft(Gt,xn,{style:""})),Ot.modal.fit(),wt(Gt,Zt),Ke(se+" "+de,xn.x,En),Ke(be,xn.header,qe),Ke(be,xn.sizer,qe),Ke(be,Rt,Tn),Ke(he,Rt,zn),Ke(ye,u,$n),T(i)&&i(xn),D=[l,Gt,xn],r&&Se("enter.modal."+t+":"+r,D),Se("enter.modal."+t,D),Se("enter.modal",D),Se("enter",D),xn.x.focus(),l},Ot.modal.fit=function(e){return wn(),K=hn/2-ne/2,V=yn/2-R/2,$(e)?(L(e[0])&&(K=e[0]),L(e[1])&&(V=e[1])):(K=d(K,0),V=d(V,0)),c(Gt,{left:K+Le,top:V+Le,"min-width":ne+Le,"min-height":R+Le,visibility:"visible"}),D=[l,Gt,xn],Se("fit.modal",D),Se("fit",D),l};var Mn={"class":Nt+"-button",name:"y"};return Ot.alert=function(e,t,n,i,r){var o=ft("button",Dt.okay,Mn),f="alert";return n=n||v,$(e)&&(f+=":"+e[0],e=e[1]||e[0]),Ke(se,o,function(e){return n(e,l),En(e,f+".y")}),Ke(de,o,function(e){var t=e.TE.key;return t(["enter","escape"])&&Ze(se,o,[e]),qe(e)}),Ot.modal(f,Cn(e,t,o),i,r),o.focus(),l},Ot.confirm=function(e,t,n,i,r,o){function c(e){return T(n)&&n(e,l),En(e,u+".y")}function d(e){return T(i)&&i(e,l),En(e,u+".n")}var a,f=ft("button",Dt.okay,Mn),s=ft("button",Dt.cancel,Mn),u="confirm";return s.name="n",Ke(se,f,c),Ke(se,s,d),Ke(de,f,function(e){return a=e.TE.key,a("right")?s.focus():a("enter")?c(e):a("escape")&&En(e,u+".y"),qe(e)}),Ke(de,s,function(e){return a=e.TE.key,a("left")?f.focus():a("enter")?d(e):a("escape")&&En(e,u+".n"),qe(e)}),Ot.modal(u,Cn(e,t,[f,s]),r,o),s.focus(),l},Ot.prompt=function(e,t,n,i,r,o,f){function y(){a.focus(),"placeholder"in a&&a.select()}function x(e){return p=a.value,T(n)&&!n(p)?y():!n||m(p)&&p!==t?(En(e,c+".y"),i(e,l,p!==t?p:"",t)):y(),qe(e)}function g(e){return En(e,c+".n")}var p,b,h,s=ft("button",Dt.okay,Mn),u=ft("button",Dt.cancel,Mn),a=ft("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Nt+"-input block"}),c="prompt",d=[];if(r=r||0,1===r)a=ft("textarea",t,{placeholder:t.split("\n")[0],"class":Nt+"-textarea block",spellcheck:"false"});else if(2===r){for(W in t)d.push(ft("option",t[W],{value:W,selected:W===n||null}));a=ft("select",d,{"class":Nt+"-select block"})}return i=i||v,a.name="data",u.name="n",Ke(de,a,function(e){return b=e.TE.key,h=e.TE.control,b("enter")&&0===r||h("enter")?x(e):b("escape")||b("back")&&!this.value?g(e):b("down")&&0===r||b("enter")&&2===r||h("down")?(s.focus(),qe(e)):void 0}),Ke(de,s,function(e){return b=e.TE.key,b("enter")?x(e):b("escape")?g(e):b("up")?a.focus():b("right")&&u.focus(),qe(e)}),Ke(de,u,function(e){return b=e.TE.key,b(["enter","escape"])?g(e):b("up")?a.focus():b("left")&&s.focus(),qe(e)}),Ke(se,s,x),Ke(se,u,g),Ot.modal(c,Cn(e,a,[s,u]),o,f),y(),l},Ot.drop=function(){Ot.exit(0,0,0);var e=arguments,t=e[0],n=e[1],i=e[2];return 1===Be(e)&&(t="default",n=e[0],i=e[1]),K=Pe(t),at(Jt,0),zt(H,ft(Jt,!1,{"class":Nt+"-drop "+K})),T(n)?n(Jt):ft(Jt,n),Ot.drop.fit(),i===!1||(Ke(se,u,Ln),Ke(me,s,Ln)),D=[l,Jt],Se("enter.drop."+t,D),Se("enter.drop",D),l},Ot.drop.fit=function(e){return D=et(_),j=et(Jt),A=Ot.drop.target,K=D.w/2-j.w/2,V=D.h/2-j.h/2,!L(e)&&A&&(t=Ve(A),K=t.l,V=t.t+et(A).h),$(e)?(L(e[0])&&(K=e[0]),L(e[1])&&(V=e[1])):(K=d(K,0,D.w-j.w),V=d(V,0,Math.max(D.h,et(s).h)-j.h)),c(Jt,{left:K+Le,top:V+Le,visibility:"visible"}),D=[l,Jt],Se("fit.drop",D),Se("fit",D),l},Ot.menu=function(e,n,i,r){var s,o=Ot.tools,f=0;if(n===!1)return Ot.tool(e,n);for(r in i)ne="%"===r[0],s=i[r],s=M(s)&&!ne?o[s]:s,s&&(s=fn(s,r,o),i[r]=s);return Ot.tool(e,{i:$(n)?n[0]:0,text:$(n)?n[1]||0:n&&i[n]&&i[n].text||n,click:function(u){var a=Ot.drop.target=o[e].target;return Ot.drop("menu menu-"+Pe(e),function(u){function c(f){return V=this,t=We(V,"tool-id"),U=i[t],U=M(U)?o[U]:U||{},Z=lt(V),!on(U)&&T(r=U.click)&&(r=r(f,l),U.i&&(o[e].i=U.i),Ot.menu.set(e,$(U.text)?[U.text[0],t]:$(n)?[n[0],t]:t),r===!1)?(l.select(),qe(f)):(l.select(),qe(f))}function d(e){if(V=this,(q=e.TE.key)("escape"))Ot.exit(1);else if(q("enter"))Ze(se,V,[e]);else if(q("f10")&&a)a.focus();else if(q("down")&&(K=ht(V))){for(;!mt(K,"a")&&K;)K=ht(K);K&&K.focus()}else if(q("up")&&(K=yt(V))){for(;!mt(K,"a")&&K;)K=yt(K);!K&&a?(Ot.exit(),a.focus()):K&&K.focus()}else q("up")&&a&&(Ot.exit(),a.focus());return qe(e)}for(r in i)if(s=i[r],ne="%"===r[0],s){var p={href:ne?null:Ce,"class":Nt+"-"+(ne?"label":"button")};ne?X=jt[e]&&jt[e][+r.slice(1)-1]||r:(p.data={},p.data["tool-id"]=r,X=Bt[r]||r),P=s.text,P=$(P)?P[1]||"":P,X=$(X)?X[0]:X,Q=ft(ne?"span":"a","<span>"+(ne?X||"%"+f:P||X)+"</span>",b(p,s.attributes||{})),nt(Q,"menu-"+Pe(r).replace(/[\/\s]/g,"-")),!p.title&&(V=s.title)&&(Q.title=$(V)?V[0]+(V[1]?" ("+V[1]+")":""):V),ne?Ye(Q,{id:Nt+"-label:"+f}):(on(s)?nt(Q,"x"):rt(Q,"x"),s.on?nt(Q,"on"):rt(Q,"on"),Ke(se,Q,c),Ke(de,Q,d)),zt(u,Q),++f}x(function(){(gt('[data-tool-id="'+We(a,ln)+'"]',u)[0]||gt("a",u)[0]).focus()},1)}),!1}},r),Re(o[e].target,{"ui-drop":e}),o[e].data=i,Ot.menu.set(e,n)},Ot.menu.set=function(e,t){var o,f,n=Ot.tools[e]||{},i=n.target,r=n.data;return i?($(t)?Re(i,ln,t[1]||""):(Re(i,ln,t),t=r[t]&&r[t].text||t),$(t)?(f=t[0],f=He(f,"<")?f:Ot.i(f,n.i),t=L(t[1])?t[1]:0,t=t&&r[t]&&r[t].text||t,t=f+(0!==t?"<span>"+($(t)?t[1]||t:t)+"</span>":"")):f=Ot.i(e,n.i),(o=gt("."+Nt+"-text",i)[0])?(nt(i,"text"),ut(o,t)):(rt(i,"text"),ut(i,f)),l):l},Ot.bubble=function(){Ot.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Be(e)&&(t="default",n=e[0]),K=Pe(t),at(Pt,0),zt(H,ft(Pt,!1,{"class":Nt+"-bubble "+K})),T(n)?n(Pt):ft(Pt,n),Ot.bubble.fit(),D=[l,Pt],Se("enter.bubble."+t,D),Se("enter.bubble",D),l},Ot.bubble.fit=function(e){Q=l.$(1),t=Ve(qt),R=c(qt,"line-height");var n="border-",i="-width";K=Q.caret[0].x+t.l-qt.scrollLeft,V=Q.caret[1].y+t.t+R-qt.scrollTop,j=c(Rt,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=et(Rt),o=et(Pt),f=j[0]+j[1],s=j[2]+j[3];return $(e)?(L(e[0])&&(K=e[0]),L(e[1])&&(V=e[1])):(K=d(K,t.l,t.l+r.w-o.w-s),V=d(V,t.t,t.t+r.h-o.h-f)),c(Pt,{left:K+Le,top:V+Le,visibility:"visible"}),D=[l,Pt],Se("fit.bubble",D),Se("fit",D),l},Ot.panel.exit=function(e){return Ot.exit(e,"panel")},Ot.overlay.exit=function(e){return Ot.exit(e,"overlay")},Ot.modal.exit=function(e){return Ot.exit(e,"modal")},Ot.drop.exit=function(e){return Ot.exit(e,"drop")},Ot.bubble.exit=function(e){return Ot.exit(e,"bubble")},Ot.tool=function(e,t,n){var i=Ot.tools;return X="",q=L(i[e])?"update":"create","|"!==e&&(N.tools=_e(N.tools||"").filter(function(t,n){return t===e?(X=n,!1):!0})),t===!1?(delete i[e],q="destroy"):("|"===e?(n=t,t={}):(T(t)&&(t={click:t}),i[e]=b(i[e]||{},t),L(n)||""===X||(n=X)),z(n)?N.tools.splice(n,0,e):N.tools.push(e)),Se(q+".tool."+e,[l,i[e]]),an(),l},Ot.separator=function(e,t){return Ot.tool("|",e!==!1?{attributes:e||{}}:!1,t)},Ot.key=function(e,t){var n=Ot.keys;return q=L(n[e])?"update":"create",t===!1?(delete n[e],q="destroy"):n[e]=t,Se(q+".key."+e,[l,n[e]]),cn(),l},Ot.key.set=function(e){B[e]=1},Ot.key.reset=function(e){e?delete B[e]:B={}},Ot.tools={"|":{},undo:{click:function(e,t){return t.undo(),!1}},redo:{click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(we),!1},outdent:function(e,t){return t.outdent(we),!1}},Ot.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return P=":not([tabindex]):not([disabled])",(Q=gt("input"+P+",button"+P+",select"+P+",textarea"+P+",a[href]"+P+",[contenteditable]"+P+',[tabindex]:not([tabindex="-1"])',u,0))&&-1!==(V=Q.indexOf(qt))?((Q[V+1]||u).focus(),!1):void 0},"alternate+f10":function(e,t){return gt("a",Xt)[0].focus(),!1},tab:ve?"indent":0,"shift+tab":ve?"outdent":0},Ot.el={container:Ft,header:It,body:Rt,footer:Wt,panel:Ut,overlay:Zt,modal:Gt,drop:Jt,bubble:Pt},l.config=N,b(TE._,{time:function(e){var t=new Date(L(e)?e:Date.now()),n=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=t.getHours(),f=t.getMinutes(),s=t.getSeconds(),u=t.getMilliseconds();return 10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>s&&(s="0"+s),10>u&&(u="0"+u),[""+n,""+i,""+r,""+o,""+f,""+s,""+u]},replace:Ge,format:Je,dom:{set:zt,reset:$t,get:gt,id:st,copy:Ct,replace:Lt,classes:{set:nt,reset:rt,toggle:ot,get:it},attributes:{set:Ye,reset:Ie,get:Fe},data:{set:Re,reset:Xe,get:We},is:mt,offset:Ve,pointer:Qe,size:et,content:{set:ut,reset:at,get:lt},closest:tt,parent:dt,children:pt,closest:bt,next:ht,previous:yt,index:xt,before:kt,after:wt,prepend:Et,append:Tt},el:ft,events:{set:Ke,reset:Ue,fire:Ze,x:qe}}),b(l._,TE._),b(l._,{hooks:{set:je,reset:Ae,fire:Se}}),l.create()},function(e,t){var n=TE,i=t.head,r="innerHTML",o="createElement",f="appendChild";n.plugs={},n.plug=function(e,r,s){var u=/\.css$/i.test(e),l=t[o](u?"link":"script");return u?(l.href=e,l.rel="stylesheet"):l.src=e,n.plugs[e]=l,(s||i)[f](l),n},n.css=function(e,s,u){var l=t[o]("style");return l[r]=e,s&&(l.id=s),(u||i)[f](l),n},n.js=function(e,s,u){var l=t[o]("script");return l[r]=e,s&&(l.id=s),(u||i)[f](l),n}}(window,document);