/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.2.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(e){function R(e,t,i){n.tools[e].click(null,i);for(D in t)(W=g("[name=data]",l)[0])&&(W.value=t[D],(O=g("[name=y]",l)[0])&&w.fire("click",O))}function L(o,a,f){J=t.languages.tools[a],D=r[a],o=D&&D.i||a,Y="|"===a,I=x(Y?"span":"a",Y?!1:-1!==o.indexOf("<")?o:n.i(a,D.i),Y?{"class":i+"-separator"}:{"class":i+"-button",href:"javascript:;",title:"object"==typeof J?J[0]+(J[1]?" ("+J[1]+")":""):J,data:{"tool-id":a}}),w.set("keydown",I,function(t){if(W=this,O=t.TE.key,j=e.$(),O("down"))return e.select(j.end+("\n"===j.after[0]?1:0)),w.x(t);if(O(["up","escape"]))return e.select(),w.x(t);if(O("right")&&(S=b(W))){for(;!m(S,"a")&&S;)S=b(S);S.focus()}else if(O("left")&&(S=y(W))){for(;!m(S,"a")&&S;)S=y(S);S.focus()}}),w.set("click",I,function(t){return D=h(this,"tool-id"),r[D].click(t,e,D),(O=g("[name=data]",l)[0])&&n.bubble(s,function(t){d(t,{"font-size":"80%"}),j=O.value,S=x("input",!1,{type:"text",value:j,placeholder:j,"class":i+"-input",spellcheck:"false"}),w.set("keydown",S,function(t){return O=t.TE.key,j=this.value,O("escape")||O(["back","enter"])&&!j?(n.bubble.exit(1),w.x(t)):O("enter")?(R(D,[j,"",""],e),w.x(t)):void 0}),A(t,S),T(function(){S.focus(),S.select()})}),B(),w.x(t)}),A(f,I)}var o,F,M,J,U,Y,I,D,W,O,j,S,t=e.config,i=t.classes[""],n=e.ui,r=n.tools,a=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ul ol hr"],s="tool "+i+"-tool",l=n.el.modal,f=n.el.bubble,c=e.target,u=e._,d=u.css,p=u.dom,A=p.append,h=p.data.get,g=p.get,m=p.is,b=p.next,y=p.previous,x=(u.edge,u.el),w=u.events,E=u.extend,C=(u.format,u.hooks),T=u.timer.set,Q=u.trim,B=function(){T(function(){n.bubble.fit()})};t.bubble&&(w.set("keydown",c,function(t){return O=t.TE.key,j=!t.TE.shift()&&g(f)[0],S=e.$(),j&&O("up")?(e.select(S.start-("\n"===S.before.slice(-1)?1:0)),w.x(t)):j&&O("down")?(g("a",f)[0].focus(),w.x(t)):void 0}),w.set("copy cut keyup mouseup paste scroll",c,function(i){O=e.$(),F=e.get(0)&&/(^|\n)$/.test(O.before)&&/^(\n|$)/.test(O.after),O.length||F?n.bubble(s,function(e){if(d(e,{padding:0,"font-size":"80%"}),o=t.bubble,o=o===!0?a:o,o="string"==typeof o?[o,o]:E(a,o),i=o[F?1:0]){M=Q(i||"").split(/\s+/);for(W in M)W=M[W],(U=r[W])&&L(U,W,e)}else n.bubble.exit()}):n.bubble.exit()}),C.set("enter.bubble",B))});