/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.5.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui.HTML=function(e,t){function H(e){return e.split(g("("+E[3]+")+"))[0]}function B(e){return F=e.match(/(?:^|\n)([\t ]*).*$/),F&&F[1]||""}function C(e,t,n){var d,r=o.$(),l=r.value,s=r.before,i=w[t]||t,a=w[n]||n,f=H(i),c=H(a),u=B(s),p=j[""];return z=i,o[0](),l&&l!==p?(o.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,L[0]+L[2]+c+L[1]+"\n"+S+L[0]+a+L[1]).wrap(L[0]+i+L[1]+"\n"+S+L[0]+a+L[1],L[0]+L[2]+c+L[1]+"\n"+L[0]+L[2]+f+L[1]+"\n\n",1).replace(g("\\n"+h(S)+R[0]+h(a)+R[1]+"\\s*"+R[0]+R[2]+h(c)+R[1]+"\\n","g"),"\n"+L[0]+L[2]+f+L[1]+"\n\n"+L[0]+i+L[1]+"\n").select(o.$().end),y&&_.tools.p.click(e,o)):(d=s.match(g("(?:^|\\n)[\\t ]+"+R[0]+"("+R[2]+"?)(?:"+h(H(w.ul))+"|"+h(H(w.ol))+")"+D+R[1]+"\\s*$")))?o.insert("\n"+u+(d[1]?"":S),0):(d=s.match(g(R[0]+h(c)+M+R[1]+".*?$")))?g(R[0]+R[2]+h(c)+R[1]+"\\s*$").test(s)?o.tidy("\n"+u,!1).insert(p).wrap(L[0]+c+d[1]+L[1],L[0]+L[2]+c+L[1]):g(R[1]+"\\s*$").test(s)?o.insert(p).wrap("\n"+u+S+L[0]+i+L[1]+"\n"+u+S+S+L[0]+c+d[1]+L[1],L[0]+L[2]+c+L[1]+"\n"+u+S+L[0]+L[2]+f+L[1]+"\n"+u).scroll(2):o.insert(L[0]+L[2]+c+L[1]+"\n"+u+L[0]+c+d[1]+L[1],0).insert(p).scroll(1):g(R[0]+R[2]+h(c)+R[1]+"\\s*$").test(s)?o.insert(p).wrap("\n"+u+L[0]+a+L[1],L[0]+L[2]+c+L[1]):o.tidy("\n\n").insert(p).wrap(L[0]+i+L[1]+"\n"+S+L[0]+a+L[1],L[0]+L[2]+c+L[1]+"\n"+L[0]+L[2]+f+L[1]),o[1](),!1}function A(e,t){return!t.get(0)&&y&&_.tools.p.click(e,t),t}function N(e){return m(e.replace(/\s+/g," "))}function Q(e){return v(N(e),[g(R[0]+".*?"+R[1],"g"),'"',"'"],["","&#34;","&#39;"])}function G(e){return v(N(e),[g(R[0]+".*?"+R[1],"g"),/\s/g,'"'],["","%20","%22"])}var z,F,n="–",r="…",l="↑",s="↓",i="↵",a="⌘",f="✘",c="⇧",o=TE.ui(e,{auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],a:{},img:{},abbr:{}},languages:{tools:{clear:["Clear Format",f],b:["Bold",a+"+B"],i:["Italic",a+"+I"],u:["Underline",a+"+U"],s:["Strike",a+"+"+f],a:["Link",a+"+L"],img:["Image",a+"+G"],sub:["Subscript",a+"+"+s],sup:["Superscript",a+"+"+l],abbr:["Abbreviation",a+"+"+c+"+?"],p:["Paragraph",a+"+"+i],br:["Line Break",c+"+"+i],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",a+"+H"],"blockquote,q":["Quote",a+"+Q"],"pre,code":["Code",a+"+K"],ul:["Unordered List",a+"+-"],ol:["Ordered List",a+"++"],table:["Table",a+"+T"],hr:["Horizontal Rule",a+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}}),u=o._,p=u.edge,h=u.x,d=u.extend,$=u.i,g=u.pattern,m=u.trim,b=u.format,v=u.replace,k=d(o.config,t),_=o.ui,y=k.auto_p,w=(k.classes,k.formats),q=k.languages,O=k.states,T=k.suffix,S=k.tab,L=k.union[1][0],I=k.union[1][1],R=k.union[0][0],E=k.union[0][1],D="(?:"+E[3]+"[^"+R[0]+R[1]+"]*?)?",M="(|"+E[3]+"[^"+R[0]+R[1]+"]*?)",U="([\\s\\S]*?)",j=q.placeholders;return o.type="HTML",d(_.tools,{clear:{i:"remove-format",click:function(e,t){var i,n=t[0]().$(),r=n.before,l=n.after,s=n.value,a=R[0]+"[^"+R[0]+R[1]+"]+?"+R[1],f=R[0]+"[^"+R[2]+R[0]+R[1]+"]+?"+R[1],c=R[0]+R[2]+"[^"+R[0]+R[1]+"]+?"+R[1];return!s&&l&&(i=g("^"+a)).test(l)?(t.replace(i,"",1),!1):(g(a).test(s)||r.slice(-1)===L[1]||l[0]===L[0]?t.replace(g(a,"g"),"").unwrap(g(f),g(c)):t.insert(""),t[1](),!!l)}},b:{i:"bold",click:function(e,t){return A(e,t).i().format(w.b),!1}},i:{i:"italic",click:function(e,t){return A(e,t).i().format(w.i),!1}},u:{i:"underline",click:function(e,t){return A(e,t).i().format(w.u),!1}},s:{i:"strike",click:function(e,t){return A(e,t).i().format(b(w.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var l,s,n=w.a,r=q.modals.a;return _.prompt(r.title[0],r.placeholder[0],1,function(e,t,i){i=G(i),l=i;var f,c,a=location.host;-1!==l.indexOf("://")&&(f=1),""!==a&&-1!==l.indexOf("://"+a)&&(f=0),/^([.\/?&#]|javascript:)/.test(l)&&(f=0),_.prompt(r.title[1],r.placeholder[1],0,function(e,t,r){s=Q(r),A(e,t).$().length||t.insert(j[""]),c=k.advance_a&&f?I[3]+"rel"+I[0]+I[1]+"nofollow"+I[2]+I[3]+"target"+I[0]+I[1]+"_blank"+I[2]:"",t.i().format(n+I[3]+"href"+I[0]+I[1]+l+I[2]+(s?I[3]+"title"+I[0]+I[1]+s+I[2]:"")+c)},0,0,"a[title]")},0,0,"a[href]").record(),!1}},img:{i:"image",click:function(e,t){var c,o,n=t.$(),r=w.img,l=w.figure,s=w.figcaption,i=n.value,a=q.modals.img,f=k.advance_img;return _.prompt(a.title[0],a.placeholder[0],1,function(e,t,n){n=G(n),c=n,_.prompt(a.title[f?2:1],a.placeholder[f?2:1],0,function(e,t,n){o=Q(n),i||(i=c.split(/[\/\\\\]/).pop()),i=Q(i),t[0](),f&&o?(t.tidy("\n\n","").insert(L[0]+l+L[1]+"\n"+S+L[0]+r+I[3]+"alt"+I[0]+I[1]+i+I[2]+I[3]+"src"+I[0]+I[1]+c+I[2]+T+"\n"+S+L[0]+s+L[1]+o+L[0]+L[2]+H(s)+L[1]+"\n"+L[0]+L[2]+H(l)+L[1]+"\n\n",0,1),y&&_.tools.p.click(e,t)):A(e,t).tidy(g(R[0]+"[^"+R[0]+R[1]+R[2]+"]+?"+R[1]+"\\s*$").test(t.$().before)?"":" ","").insert(L[0]+r+I[3]+"alt"+I[0]+I[1]+i+I[2]+I[3]+"src"+I[0]+I[1]+c+I[2]+(o?I[3]+"title"+I[0]+I[1]+o+I[2]:"")+T+" ",0,1),t[1]()},0,0,"img[title]")},0,0,"img[src]"),!1}},sub:{i:"subscript",click:function(e,t){var n=w.sub,r=w.sup,l=H(r);return A(e,t)[0]().unwrap(g(R[0]+h(l)+D+R[1]),L[0]+L[2]+l+L[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=w.sub,r=w.sup,l=H(n);return A(e,t)[0]().unwrap(g(R[0]+h(l)+D+R[1]),L[0]+L[2]+l+L[1]).i().format(r)[1](),!1}},abbr:{i:"abbreviation",click:function(e,t){var d,$,n=t.$(),r=m(n.value),l=q.modals.abbr,s=t.get(),i=m(r||j[""]),a=w.abbr,f=H(a),c=R[0]+h(a)+M+R[1],o=R[0]+h(a)+D+R[1],u=R[0]+R[2]+h(f)+R[1],p=g(c+U+u);return s.replace(p,function(e,t,n){(n=m(n))&&(O.abbr[n]=(t.match(g(E[3]+"+title"+E[0]+E[1]+"\\s*(.*?)\\s*"+E[2]))||["",""])[1])}),d=O.abbr,r&&d[r]?(t.i().format(a+I[3]+"title"+I[0]+I[1]+d[r]+I[2]),!1):(_.prompt(l.title,d[i]||l.placeholder,!d[r],function(e,t,n,l){n=Q(n||l),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for($ in d)if(Q(d[$])===n){t.insert($);break}A(e,t).unwrap(g(o),g(u)).unwrap(g(o),g(u),1).i().format(a+I[3]+"title"+I[0]+I[1]+n+I[2])[1]()},0,0,"abbr[title]").record(),!1)}},p:{i:"paragraph",click:function(e,t){var p,n=t.$(),r=n.value,l=w.p,s=w.br,i=H(l),a=H(s),f=n.before,c=n.after,o=B(f),u=j[""];if(t[0](),r&&-1!==r.indexOf("\n")){var d=g("^(?:\\s*"+R[0]+h(i)+D+R[1]+"\\s*)+"+U+"(?:\\s*"+R[0]+R[2]+h(i)+R[1]+"\\s*)+$");d.test(r)?t.replace(d,"$1").replace(g("\\s*"+R[0]+R[2]+h(i)+R[1]+"\\s*"+R[0]+h(i)+D+R[1]+"\\s*","g"),"\n\n").replace(g("\\s*"+R[0]+h(a)+D+R[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+L[0]+s+T+"\n").replace(g("(\\s*"+R[0]+h(a)+D+T+"\\s*){2,}","g"),L[0]+L[2]+i+L[1]+"\n"+L[0]+l+L[1]).wrap(L[0]+l+L[1],L[0]+L[2]+i+L[1],1).replace(g("("+R[0]+h(i)+D+R[1]+")+","g"),"$1").replace(g("("+R[0]+R[2]+h(i)+R[1]+")+","g"),"$1").tidy("\n")}else g("^\\s*"+R[0]+R[2]+h(i)+R[1]).test(c)?g(R[0]+h(i)+D+R[1]+"\\s*$").test(f)?t.unwrap(g("\\s*"+R[0]+h(i)+D+R[1]+"\\s*"),g("\\s*"+R[0]+R[2]+h(i)+R[1])).replace(u,"").tidy("\n","\n"+o):(p=f.match(g(R[0]+h(i)+M+R[1]+".*?$")))&&t.wrap(L[0]+L[2]+i+L[1]+"\n"+o+L[0]+i+p[1]+L[1],"").insert(u).scroll(1):t.tidy("\n\n").format(l,0,"\n\n").scroll(1);return t[1](),!1}},br:{i:"break",click:function(e,t){return F=B(t.$().before),t.tidy("\n","").insert(F+L[0]+w.br+T+"\n",0).scroll(1),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"headers",click:function(e,t){var s,i,n=t.$(),r=[w.p,w.h1,w.h2,w.h3,w.h4,w.h5,w.h6],l=[];for(s in r)l[s]=H(r[s]);var f=(h(r).join("|"),h(l).join("|")),c="\\s*"+R[0]+"("+f+")"+M+R[1]+"\\s*",o=g("\\s*"+R[0]+"(?:"+f+")"+D+R[1]+"\\s*"),u=g("\\s*"+R[0]+R[2]+"(?:"+f+")"+R[1]+"\\s*"),p=n.value.match(g("^"+c));return p||(p=n.before.match(g(c+"$"))||[]),i=p[2]||"",s=+(p[1]||"h0").slice(1),t[0]().unwrap(o,u).unwrap(o,u,1).i().tidy("\n\n").format(s>5?l[0]+i:l[s+1]+i,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote",click:function(e,t){var u,n=t.$(),r=n.value,l=w.blockquote,s=w.q,i=w.p,a=H(i),f=h(a),c=g(R[0]+R[2]+f+R[1]),o=j[""];return/(^|\n)$/.test(n.before)?(y&&!c.test(r)&&_.tools.p.click(e,t),n=t.$(),r=n.value,!c.test(r)&&y&&t.select(n.start-(L[0]+i+L[1]).length,n.end+(L[0]+L[2]+a+L[1]).length),r!==o&&y?(t[0]().tidy("\n\n").insert(L[0]+l+L[1]+"\n"+t.$().value.replace(g("^(\\s*"+R[0]+")","gm"),S+"$1")+"\n"+L[0]+L[2]+H(l)+L[1]+"\n\n",0,1),y&&_.tools.p.click(e,t)):(t[0]().format(l,0,"\n\n","\n").loss().replace(g("^(\\s*"+R[0]+")","gm"),S+"$1"),y&&(n=t.$(),u=n.start+(L[0]+i+L[1]+S).length,t.select(u,u+o.length))),t[1]()):t.i().format(s),!1}},"pre,code":{i:"code",click:function(e,t){function $(e){return l?v(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function m(e){return l?v(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),r=n.value,l=k.auto_encode_html,s=w.pre,i=w.code,a=H(s),f=H(i),c=R[0]+h(a)+D+R[1]+"\\s*"+R[0]+h(f)+D+R[1]+"\\s*",o="\\s*"+R[0]+R[2]+h(f)+R[1]+"\\s*"+R[0]+R[2]+h(a)+R[1],u=g(c+"\\s*$"),p=g("^\\s*"+o),d=g("^"+U+"$");return g("(^|\\n|"+c+")$").test(n.before)?u.test(n.before)&&p.test(n.after)?t[0]().unwrap(g(u),g(p)).replace(d,m)[1]():t[0]().tidy("\n\n").wrap(L[0]+s+L[1]+L[0]+i+L[1],L[0]+L[2]+f+L[1]+L[0]+L[2]+a+L[1]).insert(r||j[""]).replace(d,$)[1]():t[0]().format(i).replace(d,function(e){return N(g("^\\s*"+R[0]+R[2]+h(f)+R[1]).test(t.$().after)?$(e):m(e))})[1](),!1}},ul:{i:"list-bullet",click:function(e,t){var n=w.ol,r=w.ul,l=H(n),s=H(r),i="("+h(s)+"|"+h(l)+")";return t.match(g(R[0]+i+D+R[1]+U+R[0]+R[2]+i+R[1]))?t[0]().replace(g(R[0]+h(l)+M+R[1],"g"),L[0]+s+"$1"+L[1]).replace(g(R[0]+R[2]+h(l)+R[1],"g"),L[0]+L[2]+s+L[1])[1]():C(e,r,w.li),!1}},ol:{i:"list-number",click:function(e,t){var n=w.ol,r=w.ul,l=H(n),s=H(r),i="("+h(s)+"|"+h(l)+")";return t.match(g(R[0]+i+D+R[1]+U+R[0]+R[2]+i+R[1]))?t[0]().replace(g(R[0]+h(s)+M+R[1],"g"),L[0]+l+"$1"+L[1]).replace(g(R[0]+R[2]+h(s)+R[1],"g"),L[0]+L[2]+l+L[1])[1]():C(e,n,w.li),!1}},table:function(e,t){var j,z,F,B,n=O.tr,r=O.td,l=q.modals.table,s=q.placeholders.table,i=m(b(s[0],[1,1])),a=k.advance_table?S:"",f=w.table,c=w.caption,o=w.thead,u=w.tbody,h=w.tfoot,d=w.tr,g=w.th,v=w.td,y=H(f),x=H(c),T=H(o),I=H(u),R=H(h),E=H(d),D=H(g),M=H(v),U=[];return t[0]().$().value===i?(t.select(),!1):(_.prompt(l.title[0],l.placeholder[0],0,function(e,t,k,w){z=p($(k)||w,r[0],r[1]),_.prompt(l.title[1],l.placeholder[1],0,function(e,t,r,k){F=p($(r)||k,n[0],n[1]),_.prompt(l.title[2],l.placeholder[2],0,function(e,t,n){var l,p,$,_,w,r="";for(B=N(n),l=0;F>l;++l){for(j=a+S+L[0]+d+L[1]+"\n",p=0;z>p;++p)j+=a+S+S+L[0]+v+L[1]+m(b(s[1],[l+1,p+1]))+L[0]+L[2]+M+L[1]+"\n";j+=a+S+L[0]+L[2]+E+L[1],U.push(j)}for(U=U.join("\n"),j=S+(a?L[0]+o+L[1]+"\n"+S+S+L[0]+d+L[1]:L[0]+E+L[1])+"\n",$=0;z>$;++$)j+=a+S+S+L[0]+g+L[1]+m(b(s[0],[1,$+1]))+L[0]+L[2]+D+L[1]+"\n";if(a){for(r+=S+L[0]+h+L[1]+"\n",r+=S+S+L[0]+d+L[1]+"\n",$=0;z>$;++$)r+=S+S+S+L[0]+v+L[1]+m(b(s[2],[1,$+1]))+L[0]+L[2]+M+L[1]+"\n";r+=S+S+L[0]+L[2]+d+L[1]+"\n",r+=S+L[0]+L[2]+R+L[1]+"\n"}j+=a+S+L[0]+L[2]+E+L[1]+(a?"\n"+S+L[0]+L[2]+T+L[1]+"\n"+r+S+L[0]+u+L[1]:"")+"\n",U=j+U+(a?"\n"+S+L[0]+L[2]+I+L[1]:"")+"\n",t.tidy("\n\n").insert(L[0]+f+L[1]+"\n"+(B&&c?S+L[0]+c+L[1]+B+L[0]+L[2]+x+L[1]+"\n":"")+U+L[0]+L[2]+y+L[1]),_=t.$(),w=_.start+_.value.indexOf(i),t.select(w,w+i.length)[1]()},0,0,"table>caption")},0,0,"table>tr")},0,0,"table>td"),!1)},hr:{i:"horizontal-rule",click:function(e,t){return F=B(t.$().before),t.tidy("\n\n","").insert(F+L[0]+w.hr+T+"\n\n",0),!1}}}),k.keys&&d(_.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+down":"sub","control+up":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(e,t){var p,d,$,n=t.$(),r=n.value,l=t.get(),s=w.p,i=w.li,a=H(s),f=H(i),o=(B(n.before),j[""]),u=_.tools;if(!r||r===o){if(p=n.after.match(g("^\\s*"+R[0]+R[2]+"("+h(a)+"|"+h(f)+")"+R[1])))d=p[1],(u[d===f?z:d]||u.ul).click(e,t);else{if(!(y&&s&&m(l)&&n.end===l.length&&g("^\\s*[^"+R[0]+"\\n]*?[^"+R[1]+"]\\s*$").test(l)))return;l=L[0]+s+L[1]+l+L[0]+L[2]+a+L[1]+"\n"+L[0]+s+L[1],$=o+L[0]+L[2]+a+L[1],t.set(l+$).select(l.length,(l+o).length)}return!1}},tab:function(e,t){var n=t.$(),r=w.li,l=H(r),s=B(n.before);return g(R[0]+R[2]+h(l)+R[1]).test(n.after)?(t[0]().wrap("\n"+s+S+L[0]+(w[z]||z)+L[1]+"\n"+s+S+S+L[0]+r+L[1],L[0]+L[2]+l+L[1]+"\n"+s+S+L[0]+L[2]+z+L[1]+"\n"+s).insert(j[""])[1](),!1):_.tools.indent.click(e,t)},back:function(e,t){var l,n=t.$(),r=n.value,s=n.before,i=n.after,a=R[0]+"[^"+R[0]+R[1]+"]+?"+R[1];return!r&&g(a+"$").test(s)?(l=s.split(L[0]).pop().match(g("^([^"+R[2]+"\\s]+).*?"+R[1]+"\\s*$")),l=l&&l[1]||0,l&&g("^\\s*"+R[0]+R[2]+h(l)+R[1]).test(i)?t.unwrap(g(R[0]+h(l)+D+R[1]),g("\\s*"+R[0]+R[2]+h(l)+R[1])):t.outdent(g(a)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),o.update(t,0)};